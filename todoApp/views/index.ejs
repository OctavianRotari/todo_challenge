 <!DOCTYPE html>
<html data-ng-app="app">
   <head>
     <title><%= title %></title>
     <link rel='stylesheet' href='/stylesheets/style.css' />
   </head>
   <body>
     <h1><%= title %></h1>

    <div data-ng-view></div>


    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.2.25/angular.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.2.25/angular-resource.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.2.25/angular-route.min.js"></script>

    <script type="text/ng-template" id="/todos.html">
      Search: <input type="text" ng-model="search.name">
      <ul>
        <li ng-repeat="todo in todos | filter: search">
          <input type="checkbox" ng-model="todo.completed" ng-change="update($index)">
          <a href="#/{{todo._id}}" ng-show="!editing[$index]">{{todo.name}}</a>
          <button ng-show="!editing[$index]" ng-click="edit($index)">Edit</button>
          <input type="text" ng-show="editing[$index]" ng-model="todo.name">
          <button ng-show="editing[$index]" ng-click="update($index)">Update</button>
          <button ng-show="editing[$index]" ng-click="cancel($index)">Cancel</button>
        </li>
      </ul>
      <button ng-click="showme=true">Add a new one</button>
      <div ng-show="showme">
        New Task: <input type="text" ng-model="newTodo.todo"><br/>
        Note:     <input type="text" ng-model="newTodo.note"><br/>
        <button ng-click="save(); showme=false">Save</button>
      </div>
    </script>

    <script type="text/ng-template" id="/todoDetails.html">
      <h1>{{ todo.name }}</h1>
      completed: <input type="checkbox" ng-model="todo.completed">
      note: <p>{{ todo.note }}</p>
    </script>

    <script>
      angular.module('app', ['ngRoute', 'ngResource'])


      .factory('Todos',['$resource', function($resource){
        return $resource('/todos/:id', null,{
          'update': {method:'PUT'}
        });
      }])

      .controller('TodoController', ['$scope', 'Todos', function ($scope, Todos) {
          $scope.newTodo = {todo: null, note: null};
          $scope.editing = [];
          $scope.todos = Todos.query();

          $scope.save = function(){
            if(!$scope.newTodo || $scope.newTodo.length < 1) return;
            var todo = new Todos({name:$scope.newTodo.todo, completed:false, note:$scope.newTodo.note});

            todo.$save(function(){
              $scope.todos.push(todo);
              $scope.newTodo = {todo: null, note: null};
            });
          };

          $scope.edit = function(index){
            $scope.editing[index] = angular.copy($scope.todos[index]);
          };

          $scope.update = function(index){
            var todo = $scope.todos[index];
            Todos.update({id: todo._id}, todo);
            $scope.editing[index] = false;
          };

          $scope.cancel = function(index){
            $scope.todos[index] = angular.copy($scope.editing[index]);
            console.log($scope.editing[index])
            $scope.editing[index] = false;
          };
      }])

        .controller('TodoDetailCtrl', ['$scope', '$routeParams', 'Todos', function ($scope, $routeParams, Todos) {
          $scope.todo = Todos.get({id: $routeParams.id});
        }])


        .config(['$routeProvider', function ($routeProvider) {
          $routeProvider
            .when('/', {
              templateUrl: '/todos.html',
              controller: 'TodoController'
            })

            .when('/:id', {
              templateUrl: '/todoDetails.html',
              controller: 'TodoDetailCtrl'
           });
        }]);
    </script>
  </body>
</html>
